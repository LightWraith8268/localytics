<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Localytics</title>
    <meta name="description" content="Localytics ‚Äî CSV analytics: revenue, quantity, profit, trends.">
    <meta property="og:title" content="Localytics">
    <meta property="og:description" content="CSV analytics: revenue, quantity, profit, trends.">
    <meta property="og:type" content="website">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="./assets/css/styles.css?v=1.2.26">
    <link rel="manifest" href="./manifest.webmanifest">
    <meta name="theme-color" content="#2563eb">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="./assets/icons/icon.svg">
    <style>
      :root {
        --bg: #f8fafc;
        --card-bg: #ffffff;
        --text: #0f172a;
        --border: #e5e7eb;
        --accent: #2563eb;
      }
      .theme-dark {
        --bg: #0b1220;
        --card-bg: #111827;
        --text: #e5e7eb;
        --border: #374151;
        --accent: #3b82f6;
      }
      .theme-sepia {
        --bg: #f7f1e3;
        --card-bg: #fbfaf5;
        --text: #3e2723;
        --border: #e0d6c8;
        --accent: #b08968;
      }
      /* Additional themes */
      .theme-ocean {
        --bg: #0b132b;
        --card-bg: #1c2541;
        --text: #e5e7eb;
        --border: #3a506b;
        --accent: #5bc0be;
      }
      .theme-forest {
        --bg: #0b1f12;
        --card-bg: #123524;
        --text: #e8f5e9;
        --border: #1f6f43;
        --accent: #66bb6a;
      }
      .theme-rose {
        --bg: #fff1f2;
        --card-bg: #ffe4e6;
        --text: #4a0010;
        --border: #fecdd3;
        --accent: #e11d48;
      }
      .theme-slate {
        --bg: #0f172a;
        --card-bg: #111827;
        --text: #e2e8f0;
        --border: #334155;
        --accent: #64748b;
      }
      .theme-contrast {
        --bg: #000000;
        --card-bg: #0a0a0a;
        --text: #ffffff;
        --border: #4b5563;
        --accent: #f59e0b;
      }
      .theme-solarized-light {
        --bg: #fdf6e3;
        --card-bg: #fffdf5;
        --text: #073642;
        --border: #eee8d5;
        --accent: #268bd2;
      }
      .theme-solarized-dark {
        --bg: #002b36;
        --card-bg: #073642;
        --text: #eee8d5;
        --border: #0f3a44;
        --accent: #b58900;
      }
      .theme-dracula {
        --bg: #282a36;
        --card-bg: #343746;
        --text: #f8f8f2;
        --border: #44475a;
        --accent: #bd93f9;
      }
      .theme-nord {
        --bg: #2e3440;
        --card-bg: #3b4252;
        --text: #eceff4;
        --border: #4c566a;
        --accent: #88c0d0;
      }
      body { font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; background: var(--bg); color: var(--text); }
      .container { max-width: 1100px; }
      .hidden { display: none; }
      .monospace { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }
      .app-card { background-color: var(--card-bg) !important; border-color: var(--border) !important; }
      .app-border { border-color: var(--border) !important; }
      .accent { color: var(--accent); }
      .nav-link { color: var(--text) !important; opacity: 0.9; }
      .nav-link:hover { opacity: 1; color: var(--text) !important; }

      /* Enhanced text visibility across themes */
      .text-gray-900, .text-gray-800, .text-gray-700 { color: var(--text) !important; }
      .text-gray-600, .text-gray-500 { color: color-mix(in srgb, var(--text) 75%, var(--bg)) !important; }
      .text-blue-700, .text-blue-800 { color: var(--accent) !important; }

      /* Ensure form elements have proper contrast */
      input, select, textarea {
        background-color: var(--card-bg) !important;
        color: var(--text) !important;
        border-color: var(--border) !important;
      }

      /* Button text visibility */
      .bg-blue-50 .text-blue-700 { color: #1d4ed8 !important; }
      .bg-green-50 .text-green-700 { color: #047857 !important; }
      .bg-purple-50 .text-purple-700 { color: #7c3aed !important; }
      .bg-orange-50 .text-orange-700 { color: #c2410c !important; }
      .bg-gray-50 .text-gray-700 { color: #374151 !important; }
      /* Mobile navigation */
      @media (max-width: 767px) {
        header .nav-links {
          display: none;
          position: absolute;
          right: 1rem;
          top: 4rem;
          left: 1rem;
          background: var(--card-bg);
          border: 1px solid var(--border);
          border-radius: 8px;
          padding: 1rem;
          flex-direction: column;
          gap: 0;
          z-index: 40;
          box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
        }
        header .nav-links.show { display: flex; }

        /* Improve mobile dropdown appearance */
        header .nav-links a {
          padding: 0.75rem;
          border-radius: 6px;
          border-bottom: 1px solid var(--border);
        }
        header .nav-links a:last-of-type {
          border-bottom: none;
        }
        header .nav-links a:hover {
          background-color: color-mix(in srgb, var(--accent) 10%, var(--card-bg));
        }
      }
      /* Themed form controls */
      input[type="text"], input[type="number"], input[type="date"], input[type="time"], input[type="email"], input[type="url"], input[type="file"], select, textarea {
        background-color: var(--card-bg) !important;
        color: var(--text) !important;
        border: 1px solid var(--border) !important;
      }
      /* Themed buttons (neutral) */
      button {
        background-color: var(--card-bg) !important;
        color: var(--text) !important;
        border: 1px solid var(--border) !important;
      }
      /* Primary button override */
      .bg-blue-600 { background-color: var(--accent) !important; border-color: var(--accent) !important; color: #fff !important; }
      /* Checkbox/Radio accent */
      input[type="checkbox"], input[type="radio"] { accent-color: var(--accent); }
      input::placeholder, textarea::placeholder { color: #9aa0a6; opacity: 1; }
      input:focus, select:focus, textarea:focus { outline: none !important; border-color: var(--accent) !important; box-shadow: 0 0 0 2px color-mix(in srgb, var(--accent) 25%, transparent) !important; }
      /* File button */
      input[type="file"]::file-selector-button {
        background: color-mix(in srgb, var(--accent) 12%, var(--card-bg));
        color: var(--text);
        border: 1px solid var(--border);
        border-radius: 6px;
        padding: 6px 10px;
        margin-right: 12px;
        cursor: pointer;
      }
      @media print {
        header, .no-print { display: none !important; }
        body { background: #fff; }
        .container { max-width: none; }
        .print-section { page-break-after: always; }
        #print-cover { display: block !important; }
        /* Improve table readability in print */
        table { border-collapse: collapse; width: 100% !important; }
        thead { display: table-header-group; }
        tfoot { display: table-footer-group; }
        th, td { border: 1px solid #e5e7eb; padding: 6px 8px; }
        /* Avoid breaking boxes */
        .border { break-inside: avoid; }
        /* Chart sizing for print */
        .h-64 { height: 320px !important; }
        canvas { max-width: 100% !important; height: auto !important; }
        img.print-canvas-img { max-width: 100% !important; height: auto !important; page-break-inside: avoid; }
        details { break-inside: avoid; }
      }
    </style>
    <link rel="icon" href="data:,">
  </head>
  <body>
    <header class="app-card border-b app-border sticky top-0 z-10 no-print shadow-sm">
      <div class="container mx-auto py-4 flex items-center justify-between relative">
        <!-- Logo and Brand -->
        <div class="flex items-center gap-3">
          <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
            <span class="text-white font-bold text-sm">L</span>
          </div>
          <h1 class="text-xl md:text-2xl font-bold text-gray-900">Localytics</h1>
        </div>

        <!-- Mobile Menu Toggle -->
        <button id="navToggle" class="md:hidden px-3 py-2 border app-border rounded-lg text-sm font-medium hover:bg-gray-50" aria-expanded="false" aria-controls="navLinks">
          <span class="sr-only">Menu</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
          </svg>
          <span class="hidden sm:inline ml-2">Menu</span>
        </button>

        <!-- Navigation -->
        <nav id="navLinks" class="nav-links flex flex-col md:flex-row gap-1 md:gap-6 items-stretch md:items-center">
          <!-- Main Navigation Links -->
          <div class="flex flex-col md:flex-row gap-1 md:gap-6">
            <a href="#/upload" class="nav-link inline-flex items-center justify-center px-4 py-2.5 bg-blue-50 border border-blue-200 rounded-lg text-sm font-medium text-blue-700 transition-all duration-200 hover:bg-blue-100 hover:border-blue-300 hover:shadow-sm active:bg-blue-200 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-1">
              üì§ Upload Data
            </a>
            <a href="#/report" class="nav-link inline-flex items-center justify-center px-4 py-2.5 bg-green-50 border border-green-200 rounded-lg text-sm font-medium text-green-700 transition-all duration-200 hover:bg-green-100 hover:border-green-300 hover:shadow-sm active:bg-green-200 focus:outline-none focus:ring-2 focus:ring-green-500 focus:ring-offset-1">
              üìä Reports
            </a>
            <a href="#/custom" class="nav-link inline-flex items-center justify-center px-4 py-2.5 bg-purple-50 border border-purple-200 rounded-lg text-sm font-medium text-purple-700 transition-all duration-200 hover:bg-purple-100 hover:border-purple-300 hover:shadow-sm active:bg-purple-200 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-1">
              üé® Custom Charts
            </a>
            <a href="#/history" class="nav-link inline-flex items-center justify-center px-4 py-2.5 bg-orange-50 border border-orange-200 rounded-lg text-sm font-medium text-orange-700 transition-all duration-200 hover:bg-orange-100 hover:border-orange-300 hover:shadow-sm active:bg-orange-200 focus:outline-none focus:ring-2 focus:ring-orange-500 focus:ring-offset-1">
              üìã Saved Reports
            </a>
            <a href="#/settings" class="nav-link inline-flex items-center justify-center px-4 py-2.5 bg-gray-50 border border-gray-200 rounded-lg text-sm font-medium text-gray-700 transition-all duration-200 hover:bg-gray-100 hover:border-gray-300 hover:shadow-sm active:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-1">
              ‚öôÔ∏è Settings
            </a>
          </div>

          <!-- Theme and Actions -->
          <div class="flex flex-col md:flex-row gap-2 md:gap-3 mt-3 md:mt-0 pt-3 md:pt-0 border-t md:border-t-0 app-border md:border-l md:pl-6">
            <button id="btnOpenThemeModal" class="px-3 py-2 border app-border rounded-md text-xs font-medium hover:bg-gray-50 w-full md:w-auto">
              üé® Theme
            </button>
            <span id="appVersionBadge" title="App version" class="text-xs px-2 py-1 rounded-full border app-border app-card text-center self-center">v?</span>
          </div>
        </nav>
      </div>
    </header>

    <main class="container mx-auto py-4 md:py-6">
      <!-- Upload View -->
      <section id="view-upload" class="view">
        <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
          <h2 class="text-lg md:text-xl font-medium mb-4 md:mb-6">Upload CSV</h2>
          <input id="fileInput" type="file" accept=".csv,text/csv" multiple class="block w-full text-sm file:mr-4 file:py-2 file:px-4 file:rounded-md file:border-0 file:text-sm file:font-medium file:bg-gray-100 hover:file:bg-gray-200 mb-3">
          <div class="flex flex-col sm:flex-row sm:items-center gap-2 mb-4">
            <button id="btnLoadSample" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Load Sample Data</button>
            <span id="demoBanner" class="text-xs text-gray-600"></span>
          </div>
          <div id="parseOptions" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-3 md:gap-4">
            <div>
              <label class="block text-sm text-gray-600 mb-1">Date column</label>
              <select id="col-date" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Item/Name column</label>
              <select id="col-item" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Quantity column</label>
              <select id="col-qty" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Price column</label>
              <select id="col-price" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Revenue column (optional)</label>
              <select id="col-revenue" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Category column (optional)</label>
              <select id="col-category" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Order Number</label>
              <select id="col-order" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Client</label>
              <select id="col-client" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Staff</label>
              <select id="col-staff" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
            <div>
              <label class="block text-sm text-gray-600 mb-1">Cost (unit)</label>
              <select id="col-cost" class="w-full border rounded-md px-3 py-2 text-sm"></select>
            </div>
          </div>
          <div class="mt-4 flex flex-col sm:flex-row sm:items-center gap-3">
            <button id="btnParse" class="inline-flex items-center justify-center px-6 py-3 bg-blue-600 text-white text-sm font-medium rounded-md hover:bg-blue-700 disabled:opacity-50 w-full sm:w-auto">Parse & Generate</button>
            <span id="uploadStatus" class="text-sm text-gray-600 text-center sm:text-left"></span>
          </div>
          <div id="parseProgressWrap" class="mt-4 hidden flex-col sm:flex-row sm:items-center gap-3">
            <div class="w-full sm:w-56 h-2 bg-gray-200 rounded overflow-hidden app-border border" aria-hidden="true">
              <div id="parseProgressBar" class="h-2 bg-blue-600" style="width:0%"></div>
            </div>
            <span id="parseProgressText" class="text-xs text-gray-600 text-center sm:text-left">0%</span>
          </div>
        </div>
      </section>

      <!-- Report View -->
      <section id="view-report" class="view hidden">
        <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
          <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-3 no-print mb-4">
            <h2 class="text-lg md:text-xl font-medium">Report</h2>
            <div class="flex flex-col sm:flex-row gap-2 w-full sm:w-auto">
              <div class="relative inline-block w-full sm:w-auto">
                <button id="exportMenuBtn" class="w-full sm:w-auto px-4 py-2 border app-border rounded-md text-sm font-medium">Export ‚ñæ</button>
                <div id="exportMenu" class="dropdown-menu hidden absolute right-0 mt-2 app-card border app-border rounded-md shadow p-2 z-20 min-w-48">
                  <button id="btnExportItem" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Items CSV</button>
                  <button id="btnExportDate" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Dates CSV</button>
                  <button id="btnExportClient" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Clients CSV</button>
                  <button id="btnExportStaff" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Staff CSV</button>
                  <button id="btnExportOrder" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Orders CSV</button>
                  <button id="btnExportCategory" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Categories CSV</button>
                  <button id="btnExportExcel" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Excel Workbook</button>
                </div>
              </div>
              <div class="relative inline-block w-full sm:w-auto">
                <button id="printMenuBtn" class="w-full sm:w-auto px-4 py-2 border app-border rounded-md text-sm font-medium">Print ‚ñæ</button>
                <div id="printMenu" class="dropdown-menu hidden absolute right-0 mt-2 app-card border app-border rounded-md shadow p-2 z-20 min-w-32">
                  <button id="btnPrintReport" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Print</button>
                  <button id="btnPrintAll" class="block w-full text-left px-3 py-2 rounded-md text-sm hover:bg-gray-50">Print All</button>
                </div>
              </div>
              <button id="btnSaveReport" class="w-full sm:w-auto px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Report</button>
            </div>
          </div>
          <div class="mt-4 grid grid-cols-1 md:grid-cols-3 gap-3 no-print">
            <div>
              <label class="block text-xs text-gray-500 mb-1">Start date</label>
              <input type="date" id="filterStart" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">End date</label>
              <input type="date" id="filterEnd" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Item contains</label>
              <input type="text" id="filterItem" placeholder="e.g., Widget" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
          </div>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 no-print">
            <div>
              <label class="block text-xs text-gray-500 mb-1">Client contains</label>
              <input type="text" id="filterClient" placeholder="e.g., Acme" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Staff contains</label>
              <input type="text" id="filterStaff" placeholder="e.g., Jane" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Order contains</label>
              <input type="text" id="filterOrder" placeholder="e.g., 1234" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
          </div>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 no-print">
            <div>
              <label class="block text-xs text-gray-500 mb-1">Category contains</label>
              <input type="text" id="filterCategory" placeholder="e.g., Services" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Min revenue</label>
              <input type="number" id="filterRevMin" step="0.01" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Max revenue</label>
              <input type="number" id="filterRevMax" step="0.01" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
          </div>
          <div class="mt-3 grid grid-cols-1 md:grid-cols-3 gap-3 no-print">
            <div>
              <label class="block text-xs text-gray-500 mb-1">Min quantity</label>
              <input type="number" id="filterQtyMin" step="1" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Max quantity</label>
              <input type="number" id="filterQtyMax" step="1" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
            <div class="flex items-end">
              <label class="inline-flex items-center gap-2 text-sm text-gray-700">
                <input type="checkbox" id="filterNoZero" class="h-4 w-4"> Exclude zero qty/revenue
              </label>
            </div>
          </div>
          <div class="mt-4 flex flex-col sm:flex-row gap-2 no-print">
            <button id="btnApplyFilters" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50 w-full sm:w-auto">Apply Filters</button>
            <button id="btnClearFilters" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50 w-full sm:w-auto">Clear</button>
          </div>
          <!-- Key Metrics Summary -->
          <div class="mt-6">
            <h2 class="text-xl font-semibold text-gray-900 mb-4 print-section">üìä Performance Summary</h2>
            <div id="totals" class="grid grid-cols-1 sm:grid-cols-3 gap-4 print-section"></div>
          </div>

          <!-- Data Tables Section -->
          <div class="mt-8">
            <h2 class="text-xl font-semibold text-gray-900 mb-6 print-section">üìã Data Analysis & Breakdowns</h2>
            <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 print-section">
              <details class="app-card border app-border rounded-lg p-4" open data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üì¶ Product Performance</summary>
                <div id="table-item" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
              <details class="app-card border app-border rounded-lg p-4" data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üìÖ Daily Sales Trends</summary>
                <div id="table-date" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
              <details class="app-card border app-border rounded-lg p-4" data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üë• Client Revenue Analysis</summary>
                <div id="table-client-main" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
              <details class="app-card border app-border rounded-lg p-4" data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üë§ Staff Performance Metrics</summary>
                <div id="table-staff-main" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
              <details class="app-card border app-border rounded-lg p-4" id="section-category" data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üè∑Ô∏è Category Breakdown</summary>
                <div id="table-category-main" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
              <details class="app-card border app-border rounded-lg p-4" data-accordion>
                <summary class="cursor-pointer select-none text-lg font-medium text-gray-800 mb-2">üßæ Order Analysis</summary>
                <div id="table-order-main" class="mt-3 overflow-x-auto border app-border rounded-md"></div>
              </details>
            </div>
          </div>
          <details class="app-card border app-border rounded-md p-3 mt-6" data-accordion open>
            <summary class="cursor-pointer select-none text-sm font-semibold">Trends & Charts</summary>
            <!-- Core Time Series Section -->
            <div class="mt-3">
              <h4 class="text-base font-medium text-blue-800 mb-4 border-b border-blue-200 pb-2">üìä Core Time Series</h4>
              <div>
                <h3 class="text-sm font-semibold mb-2">Revenue by Date</h3>
                <div class="h-64"><canvas id="chart-revenue" data-zoom="1"></canvas></div>
              </div>
              <div class="mt-6 grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Quantity by Date</h3>
                  <div class="h-64"><canvas id="chart-qty" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Orders by Date</h3>
                  <div class="h-64"><canvas id="chart-orders" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>

            <!-- Top Rankings Section -->
            <div class="mt-8">
              <h4 class="text-base font-medium text-green-800 mb-4 border-b border-green-200 pb-2">üèÜ Top Rankings</h4>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Top Items by Revenue</h3>
                  <div class="h-64"><canvas id="chart-top-items" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Top Clients by Revenue</h3>
                  <div class="h-64"><canvas id="chart-top-clients" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>

            <!-- Profitability Analysis Section -->
            <div class="mt-8">
              <h4 class="text-base font-medium text-purple-800 mb-4 border-b border-purple-200 pb-2">üí∞ Profitability Analysis</h4>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Profit by Date</h3>
                  <div class="h-64"><canvas id="chart-profit" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Margin % by Date</h3>
                  <div class="h-64"><canvas id="chart-margin" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Average Order Value (AOV)</h3>
                  <div class="h-64"><canvas id="chart-aov" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Items per Order</h3>
                  <div class="h-64"><canvas id="chart-ipo" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>

            <!-- Trend Analysis Section -->
            <div class="mt-8">
              <h4 class="text-base font-medium text-orange-800 mb-4 border-b border-orange-200 pb-2">üìà Trend Analysis</h4>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Rolling 7-day Avg Revenue</h3>
                  <div class="h-64"><canvas id="chart-rev-rolling" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">7-day Rolling Quantity</h3>
                  <div class="h-64"><canvas id="chart-qty-rolling" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">30-day Rolling Revenue</h3>
                  <div class="h-64"><canvas id="chart-rev-rolling-30" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue Month-over-Month Change %</h3>
                  <div class="h-64"><canvas id="chart-rev-mom" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue YoY Change (Monthly)</h3>
                  <div class="h-64"><canvas id="chart-rev-yoy" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Category Trend by Month</h3>
                  <div class="h-64"><canvas id="chart-cat-trend" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>

            <!-- Time Pattern Analysis Section -->
            <div class="mt-8">
              <h4 class="text-base font-medium text-indigo-800 mb-4 border-b border-indigo-200 pb-2">‚è∞ Time Pattern Analysis</h4>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Average Revenue by Day of Week</h3>
                  <div class="h-64"><canvas id="chart-dow-revenue" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue by Hour of Day</h3>
                  <div class="h-64"><canvas id="chart-hour-revenue" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>

            <!-- Segment Analysis Section -->
            <div class="mt-8">
              <h4 class="text-base font-medium text-red-800 mb-4 border-b border-red-200 pb-2">üë• Segment Analysis</h4>
              <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue by Client</h3>
                  <div class="h-64"><canvas id="chart-by-client" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue by Staff</h3>
                  <div class="h-64"><canvas id="chart-by-staff" data-zoom="1"></canvas></div>
                </div>
                <div>
                  <h3 class="text-sm font-semibold mb-2">Revenue by Order</h3>
                  <div class="h-64"><canvas id="chart-by-order" data-zoom="1"></canvas></div>
                </div>
              </div>
            </div>
          </details>
        </div>
      </section>

      <!-- Custom View -->
      <section id="view-custom" class="view hidden">
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-5">
          <div class="flex items-center justify-between no-print">
            <h2 class="text-base font-medium">Custom Charts & Reports</h2>
            <div class="flex gap-2">
              <button id="btnBuildChart" class="px-3 py-1.5 border rounded-md text-sm">Build Chart</button>
              <button id="btnPrintChart" class="px-3 py-1.5 border rounded-md text-sm">Print Chart</button>
              <button id="btnBuildTable" class="px-3 py-1.5 border rounded-md text-sm">Build Table</button>
              <button id="btnExportCustomCsv" class="px-3 py-1.5 border rounded-md text-sm">Export Table CSV</button>
              <button id="btnPrintTable" class="px-3 py-1.5 border rounded-md text-sm">Print Table</button>
            </div>
          </div>
          <div class="mt-4 grid grid-cols-1 md:grid-cols-5 gap-3 no-print">
            <div>
              <label class="block text-xs text-gray-500 mb-1">Group by</label>
              <select id="customGroupBy" class="w-full border rounded-md px-3 py-2 text-sm">
                <option value="date">Date</option>
                <option value="item">Item</option>
                <option value="category">Category</option>
              </select>
            </div>
            <div id="granularityWrap">
              <label class="block text-xs text-gray-500 mb-1">Granularity</label>
              <select id="customGranularity" class="w-full border rounded-md px-3 py-2 text-sm">
                <option value="day">Day</option>
                <option value="week">Week</option>
                <option value="month" selected>Month</option>
                <option value="quarter">Quarter</option>
                <option value="year">Year</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Metric</label>
              <select id="customMetric" class="w-full border rounded-md px-3 py-2 text-sm">
                <option value="revenue" selected>Revenue</option>
                <option value="quantity">Quantity</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Chart type</label>
              <select id="customChartType" class="w-full border rounded-md px-3 py-2 text-sm">
                <option value="line" selected>Line</option>
                <option value="bar">Bar</option>
                <option value="pie">Pie</option>
                <option value="doughnut">Doughnut</option>
              </select>
            </div>
            <div>
              <label class="block text-xs text-gray-500 mb-1">Top N (items)</label>
              <input type="number" id="customTopN" min="1" max="100" value="10" class="w-full border rounded-md px-3 py-2 text-sm">
            </div>
          </div>
          <div class="mt-4 print-section">
            <div class="h-96"><canvas id="customChart"></canvas></div>
          </div>
          <div class="mt-3 no-print">
            <label class="inline-flex items-center gap-2 text-sm text-gray-700">
              <input type="checkbox" id="customStackCat" class="h-4 w-4">
              <span>Stack by Category (date charts)</span>
            </label>
          </div>
          <div class="mt-6">
            <div id="customTable" class="overflow-auto border rounded-md"></div>
          </div>
        </div>
      </section>

      <!-- History View -->
      <section id="view-history" class="view hidden">
        <div class="app-card rounded-lg border app-border shadow-sm p-5">
          <div class="flex items-center justify-between">
            <h2 class="text-base font-medium">History</h2>
            <button id="btnRefreshHistory" class="px-3 py-1.5 border rounded-md text-sm">Refresh</button>
          </div>
          <div id="historyList" class="mt-4 divide-y"></div>
        </div>
      </section>

      <!-- Settings View -->
      <section id="view-settings" class="view hidden">
        <div class="space-y-6">

          <!-- Account Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Account & Authentication</h2>
            <div class="space-y-4">
              <div class="flex flex-col sm:flex-row sm:items-center justify-between gap-4">
                <div>
                  <p id="authStatus" class="text-sm font-medium">Not signed in.</p>
                  <p class="text-xs text-gray-600 mt-1">Sign in to sync your data across devices</p>
                </div>
                <div class="flex gap-2">
                  <button id="btnSignIn" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Sign in with Google</button>
                  <button id="btnSignOut" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50 hidden">Sign out</button>
                </div>
              </div>
            </div>
          </div>

          <!-- Data Management Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Data Management</h2>
            <div class="space-y-4">
              <div class="bg-blue-50 border border-blue-200 rounded-md p-4">
                <h3 class="text-sm font-medium text-blue-900">Automatic Data Storage</h3>
                <p class="text-xs text-blue-700 mt-1">Your uploaded CSV data is automatically saved to Firebase (when signed in) or browser storage. Data persists between sessions.</p>
              </div>

              <div class="flex flex-col sm:flex-row gap-3">
                <button id="btnDeleteCsvData" class="px-4 py-2 border border-orange-300 text-orange-700 rounded-md text-sm font-medium hover:bg-orange-50">Clear CSV Data</button>
                <button id="btnDeleteAllData" class="px-4 py-2 border border-red-300 text-red-700 rounded-md text-sm font-medium hover:bg-red-50">Delete All Data</button>
              </div>

              <div class="text-xs text-gray-600">
                <p><strong>Clear CSV Data:</strong> Removes uploaded CSV data but keeps settings and reports</p>
                <p><strong>Delete All Data:</strong> Removes everything including settings, reports, and CSV data</p>
              </div>
            </div>
          </div>

          <!-- Appearance Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Appearance & Theme</h2>
            <div class="space-y-4">
              <p class="text-sm text-gray-600">Choose a predefined theme or create your own custom theme</p>
              <button id="btnOpenThemeModal" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Customize Theme</button>
            </div>
          </div>

          <!-- Branding Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Branding & Identity</h2>
            <div class="space-y-4">
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Brand Name</label>
                  <input type="text" id="brandName" placeholder="Your company" class="w-full border app-border rounded-md px-3 py-2 text-sm">
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Logo URL</label>
                  <input type="url" id="brandLogo" placeholder="https://...logo.png" class="w-full border app-border rounded-md px-3 py-2 text-sm">
                </div>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700 mb-2">Owner Email</label>
                  <input type="email" id="ownerEmail" placeholder="you@example.com" class="w-full border app-border rounded-md px-3 py-2 text-sm">
                  <p class="text-xs text-gray-600 mt-1">Restrict features to this user</p>
                </div>
                <div class="flex items-end">
                  <button id="btnSaveOwner" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Save Owner</button>
                </div>
              </div>
              <div>
                <button id="btnSaveBrand" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Branding</button>
              </div>
            </div>
          </div>

          <!-- Category Mapping Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Category Mapping</h2>
            <div class="space-y-4">
              <p class="text-sm text-gray-600">Assign categories to item names. Manual mappings override CSV categories.</p>
              <div class="flex flex-col sm:flex-row gap-2">
                <button id="btnLoadItemsMapping" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Load Items from Data</button>
                <button id="btnSaveCategoryMap" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Mapping</button>
                <button id="btnClearCategoryMap" class="px-4 py-2 border border-orange-300 text-orange-700 rounded-md text-sm font-medium hover:bg-orange-50">Clear Mapping</button>
              </div>
              <div id="categoryMapEditor" class="max-h-96 overflow-auto border app-border rounded-md divide-y"></div>
            </div>
          </div>

          <!-- Item Filter Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Allowed Items Filter</h2>
            <div class="space-y-4">
              <p class="text-sm text-gray-600">Hard-code a list of item names (one per line) to include. If enabled, only rows whose item matches will be used.</p>
              <textarea id="allowedItems" rows="6" class="w-full border app-border rounded-md px-3 py-2 text-sm monospace" placeholder="Widget A&#10;Widget B&#10;Product C"></textarea>
              <div class="flex items-center gap-2">
                <input type="checkbox" id="enforceAllowed" class="h-4 w-4">
                <label for="enforceAllowed" class="text-sm">Enforce allowed items only</label>
              </div>
              <div>
                <button id="btnSaveAllowed" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Allowed Items</button>
              </div>
            </div>
          </div>

          <!-- Item Synonyms Section -->
          <div class="app-card rounded-lg border app-border shadow-sm p-4 md:p-6">
            <h2 class="text-lg md:text-xl font-medium mb-4">Item Synonyms</h2>
            <div class="space-y-4">
              <p class="text-sm text-gray-600">Define mappings to normalize names. One mapping per line using "from => to". Example: <span class="monospace">Tri Color => Northern</span></p>
              <textarea id="itemSynonyms" rows="6" class="w-full border app-border rounded-md px-3 py-2 text-sm monospace" placeholder="Tri Color => Northern&#10;Tri-Color => Northern"></textarea>
              <div class="flex flex-col sm:flex-row gap-2">
                <button id="btnSaveSynonyms" class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Synonyms</button>
                <button id="btnClearSynonyms" class="px-4 py-2 border border-orange-300 text-orange-700 rounded-md text-sm font-medium hover:bg-orange-50">Clear Synonyms</button>
              </div>
            </div>
          </div>

        </div>
      </section>
    </main>

    <!-- Vendor libs -->
    <script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.3/dist/chart.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>

    <!-- Firebase init (loads config from assets/js/firebase.js) -->
    <script type="module" src="./assets/js/firebase-init.js"></script>

    <!-- App scripts -->
    <script type="module" src="./assets/js/app.js?v=1.2.26"></script>
    <!-- Workbox update flow -->
    <div id="sw-update" class="hidden fixed top-4 right-4 app-card border app-border rounded-md shadow-lg px-3 py-2 z-50">
      <div class="flex items-center gap-3">
        <span class="text-sm">Update available</span>
        <button id="btnSwUpdate" class="px-2 py-1 bg-blue-600 text-white text-xs rounded-md">Update</button>
      </div>
    </div>
    <script type="module">
      import { Workbox } from 'https://storage.googleapis.com/workbox-cdn/releases/6.5.4/workbox-window.prod.mjs';
      if ('serviceWorker' in navigator) {
        const swUrl = './service-worker.js' + (window.APP_VERSION ? ('?v=' + window.APP_VERSION) : '');
        const wb = new Workbox(swUrl, { updateViaCache: 'none' });
        const banner = document.getElementById('sw-update');
        const btn = document.getElementById('btnSwUpdate');
        const showBanner = () => { if (banner) banner.classList.remove('hidden'); };
        const hideBanner = () => { if (banner) banner.classList.add('hidden'); };

        // Query the waiting SW for its version; only surface banner if it differs from the page APP_VERSION
        async function maybeShowBanner() {
          try {
            const reg = await navigator.serviceWorker.getRegistration();
            const waiting = reg?.waiting;
            if (!waiting) return;
            const swVersion = await new Promise((resolve) => {
              const channel = new MessageChannel();
              const timeout = setTimeout(() => resolve(null), 1500);
              channel.port1.onmessage = (event) => { clearTimeout(timeout); resolve(event?.data?.version || null); };
              try { waiting.postMessage({ type: 'GET_VERSION' }, [channel.port2]); } catch { clearTimeout(timeout); resolve(null); }
            });
            if (!swVersion) return; // Unknown -> avoid false positives
            const swVer = String(swVersion).replace(/^wb-/, '');
            const appVer = String(window.APP_VERSION || '');
            if (swVer && appVer && swVer !== appVer) {
              showBanner();
            } else {
              hideBanner();
            }
          } catch {
            // If anything fails, be conservative: don't show
            hideBanner();
          }
        }

        wb.addEventListener('waiting', () => { maybeShowBanner(); });
        wb.addEventListener('externalwaiting', () => { maybeShowBanner(); });
        btn?.addEventListener('click', () => { wb.messageSkipWaiting(); });
        wb.addEventListener('controlling', () => { hideBanner(); window.location.reload(); });

        wb.register().then((reg) => {
          const checkNow = () => { wb.update(); };
          // Check immediately after registration
          checkNow();
          // Listen for new installing worker and surface banner once installed/waiting
          const listenUpdateFound = (registration) => {
            registration.addEventListener('updatefound', () => {
              const sw = registration.installing;
              if (!sw) return;
              sw.addEventListener('statechange', () => {
                if (sw.state === 'installed' && registration.waiting) { maybeShowBanner(); }
              });
            });
          };
          listenUpdateFound(reg);
          // Proactively check for updates on an interval (no manual refresh needed)
          const intervalMs = 20_000;
          setInterval(() => { if (document.visibilityState === 'visible') checkNow(); }, intervalMs);
          // Also check on page focus/visibility (tab switch brings it to front)
          window.addEventListener('focus', checkNow);
          document.addEventListener('visibilitychange', () => { if (document.visibilityState === 'visible') checkNow(); });
          window.addEventListener('pageshow', checkNow);
        });
      }
    </script>
    <script nomodule>
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.register('./service-worker.js');
      }
    </script>
    
    <!-- Print cover (hidden on screen) -->
    <div id="print-cover" class="hidden">
      <div class="container mx-auto px-4 py-10">
        <div class="flex items-center gap-4">
          <img id="printLogo" alt="Logo" style="max-height:60px; display:none;" />
          <div>
            <h1 id="printBrand" class="text-2xl font-semibold">Reports</h1>
            <div class="text-sm text-gray-600" id="printSubtitle">Generated on <span id="printDate"></span></div>
          </div>
        </div>
        <div class="mt-6 grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <div class="text-xs text-gray-500">Filters</div>
            <div class="mt-1 text-sm" id="printFilters">None</div>
          </div>
          <div>
            <div class="text-xs text-gray-500">Column Mapping</div>
            <div class="mt-1 text-sm" id="printMapping">‚Äî</div>
          </div>
        </div>
      </div>
    </div>
  <!-- Theme Modal -->
  <!-- Theme Customization Modal -->
  <div id="themeModal" class="hidden fixed inset-0 z-50 flex items-center justify-center px-4" style="background: rgba(0,0,0,0.75);">
    <div class="app-card border app-border rounded-xl shadow-2xl overflow-hidden" style="max-width:900px; width:100%; max-height:90vh;">
        <!-- Modal Header -->
        <div class="flex items-center justify-between p-6 border-b app-border">
          <div>
            <h3 class="text-xl font-semibold">Theme Customization</h3>
            <p class="text-sm text-gray-600 mt-1">Choose a preset theme or create your own custom design</p>
          </div>
          <button id="btnCloseThemeModal" class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">‚úï Close</button>
        </div>

        <div class="p-6 overflow-y-auto" style="max-height:calc(90vh - 120px);">
          <!-- Preset Themes -->
          <div class="mb-8">
            <h4 class="text-lg font-medium mb-4">Preset Themes</h4>
            <div class="grid grid-cols-2 md:grid-cols-4 gap-3">
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="light">
                <div class="w-full h-8 rounded mb-2 bg-gray-100 border"></div>
                Light
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="dark">
                <div class="w-full h-8 rounded mb-2 bg-gray-800"></div>
                Dark
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="sepia">
                <div class="w-full h-8 rounded mb-2 bg-yellow-100 border"></div>
                Sepia
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="ocean">
                <div class="w-full h-8 rounded mb-2 bg-blue-900"></div>
                Ocean
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="forest">
                <div class="w-full h-8 rounded mb-2 bg-green-900"></div>
                Forest
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="rose">
                <div class="w-full h-8 rounded mb-2 bg-pink-100 border"></div>
                Rose
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="dracula">
                <div class="w-full h-8 rounded mb-2 bg-purple-900"></div>
                Dracula
              </button>
              <button class="theme-preset p-3 border app-border rounded-lg text-sm font-medium hover:border-blue-500" data-theme="nord">
                <div class="w-full h-8 rounded mb-2 bg-slate-600"></div>
                Nord
              </button>
            </div>
          </div>

          <!-- Custom Theme Editor -->
          <div class="mb-8">
            <h4 class="text-lg font-medium mb-4">Custom Theme Editor</h4>
            <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-5 gap-4">
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Background</label>
                <input type="color" id="ctBg" class="w-full h-12 border app-border rounded-md cursor-pointer" value="#f8fafc" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Card Background</label>
                <input type="color" id="ctCard" class="w-full h-12 border app-border rounded-md cursor-pointer" value="#ffffff" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Text Color</label>
                <input type="color" id="ctText" class="w-full h-12 border app-border rounded-md cursor-pointer" value="#0f172a" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Border Color</label>
                <input type="color" id="ctBorder" class="w-full h-12 border app-border rounded-md cursor-pointer" value="#e5e7eb" />
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-2">Accent Color</label>
                <input type="color" id="ctAccent" class="w-full h-12 border app-border rounded-md cursor-pointer" value="#2563eb" />
              </div>
            </div>

            <div class="mt-6 flex flex-col sm:flex-row gap-3">
              <button id="btnSaveCustomTheme" class="px-6 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Save Custom Theme</button>
              <button id="btnResetCustomTheme" class="px-6 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Reset to Defaults</button>
            </div>
          </div>

          <!-- Live Preview -->
          <div>
            <h4 class="text-lg font-medium mb-4">Live Preview</h4>
            <div id="themePreview" class="app-card border app-border rounded-lg p-6">
              <div class="flex items-center justify-between mb-4">
                <h5 class="text-lg font-semibold">Sample Report</h5>
                <span class="px-3 py-1 bg-blue-600 text-white rounded-full text-xs">Live Preview</span>
              </div>
              <p class="text-sm text-gray-600 mb-4">This preview shows how your theme will look across the application.</p>
              <div class="flex flex-wrap gap-2 mb-4">
                <button class="px-4 py-2 border app-border rounded-md text-sm font-medium hover:bg-gray-50">Neutral Button</button>
                <button class="px-4 py-2 bg-blue-600 text-white rounded-md text-sm font-medium hover:bg-blue-700">Primary Button</button>
                <select class="px-3 py-2 border app-border rounded-md text-sm">
                  <option>Sample Dropdown</option>
                </select>
              </div>
              <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                <div class="app-card border app-border rounded-md p-3">
                  <div class="text-sm font-medium">Revenue</div>
                  <div class="text-xl font-bold">$12,345</div>
                </div>
                <div class="app-card border app-border rounded-md p-3">
                  <div class="text-sm font-medium">Orders</div>
                  <div class="text-xl font-bold">456</div>
                </div>
                <div class="app-card border app-border rounded-md p-3">
                  <div class="text-sm font-medium">Items</div>
                  <div class="text-xl font-bold">789</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
  </body>
  <!-- Chart Zoom Modal -->
  <div id="chartZoom" class="hidden fixed top-0 left-0 right-0 bottom-0 z-50" style="background: rgba(0,0,0,0.6);">
    <div class="absolute inset-0 flex items-center justify-center">
      <img id="chartZoomImg" alt="Chart" style="max-width: 90vw; max-height: 90vh; box-shadow: 0 10px 30px rgba(0,0,0,.4); border-radius: 8px; background: #fff;" />
    </div>
  </div>
  </html>
